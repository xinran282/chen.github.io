<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="欣然的备忘录">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="欣然的备忘录">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="欣然">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>欣然的备忘录</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">欣然的备忘录</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/14/lua%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="欣然">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="欣然的备忘录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/14/lua%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">lua笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-04-14 09:36:44 / 修改时间：09:37:24" itemprop="dateCreated datePublished" datetime="2022-04-14T09:36:44+08:00">2022-04-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/lua/" itemprop="url" rel="index"><span itemprop="name">lua</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="skynet"><a href="#skynet" class="headerlink" title="skynet"></a>skynet</h2><ol>
<li>同一服务内的不同用户线程永远是轮流获得执行权的，每个线程都会需要一个阻塞操作而挂起让出控制权，也会在其它线程让出控制权后再延续运行</li>
<li>skynet 并不是一个抢占式调度器，没有时间片的设计，不会因为一个工作线工作时间过长而强制挂起它</li>
<li>消息由 6 部分构成：消息类型、session 、发起服务地址 、接收服务地址 、消息 C 指针、消息长度。</li>
<li><a target="_blank" rel="noopener" href="https://www.zybuluo.com/wsd1/note/564718">skynet.register_protocol() 和 skynet.dispatch()</a> <br>dispatch处理lua类消息，register_protocol支持自定义类消息（如socket传来的消息）</li>
</ol>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/llh_1178/article/details/79329250">gcc4.9安装</a> </p>
<p><a target="_blank" rel="noopener" href="http://ftp.gnu.org/gnu/gcc/gcc-4.9.4/gcc-4.9.4.tar.gz">gcc4.9.4 安装包</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 需要 gcc4.9</span><br><span class="line">yum install gcc-c++</span><br><span class="line">yum install -y readline-devel autoconf</span><br><span class="line"></span><br><span class="line">git clone https://github.com/cloudwu/skynet.git</span><br><span class="line">cd skynet</span><br><span class="line">make linux</span><br></pre></td></tr></table></figure>

<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><p>映射关系</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>函数说明</th>
<th>回调</th>
<th>回调说明</th>
</tr>
</thead>
<tbody><tr>
<td>newservice(Name)</td>
<td>启动一个服务</td>
<td>Name文件中的skenet.start</td>
<td>在其中指定了该服务的回调函数组</td>
</tr>
<tr>
<td>call(Name, “lua”, Func, Arg)</td>
<td>Name:服务名 “lua”为消息类型 Func:调用函数 Arg:其他参数</td>
<td>Name文件中的函数</td>
<td></td>
</tr>
</tbody></table>
<h3 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h3><ul>
<li>userdata、lightuserdata<ul>
<li>可以让C返回一个句柄给Lua，而Lua可以将句柄再通过在C中注册的方法传回C</li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/fwb330198372/article/details/82217022">区别</a></li>
</ul>
</li>
</ul>
<h3 id="question"><a href="#question" class="headerlink" title="question"></a>question</h3><ol>
<li>怎么创建一个进程（或者说服务）？</li>
<li>进程内的数据怎么保存？<ol>
<li>相当于一个全局变量</li>
</ol>
</li>
<li>怎么与socket进程通信？</li>
<li>垃圾回收机制是怎样的？</li>
<li>有没有性能分析工具？<ol>
<li>skynet.stat(“mqlen” | “cpu” | “message”)</li>
<li><a target="_blank" rel="noopener" href="https://github.com/cloudwu/skynet/wiki/Profile">profile</a></li>
</ol>
</li>
<li>各种瓶颈数值（进程数、端口数）</li>
<li>skynet<ol>
<li>call(addr, type, …) 用 type 类型发送一个消息到 addr ，并等待对方的回应。</li>
<li>dispatch(type, func) 为 type 类型的消息设定一个处理函数。</li>
<li>redirect(addr, source, type, …) 伪装成 source 地址，向 addr 发送一个消息。</li>
<li>send(addr, type, …) 用 type 类型向 addr 发送一个消息。</li>
</ol>
</li>
<li>有交互调试shell吗？<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/cloudwu/skynet/wiki/DebugConsole">DebugConsole</a></li>
</ol>
</li>
<li>支持热更吗？<ol>
<li>连接到debug_console，使用clearcache清掉代码缓存，会使内存增大，但可以再调用gc回收</li>
<li>本质是替换变量的值（函数也是变量）</li>
<li><a target="_blank" rel="noopener" href="https://blog.codingnow.com/2016/11/lua_update.html">尽量正确的热更新</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/losophy/p/9204036.html">skynet：热更新 lua 代码</a></li>
</ol>
</li>
<li>怎么启动<br>./skynet ConfigFile<br>配置文件的start为启动入口<br><a target="_blank" rel="noopener" href="https://github.com/cloudwu/skynet/wiki/Config">Skynet配置</a>    </li>
</ol>
<h3 id="源码解析"><a href="#源码解析" class="headerlink" title="源码解析"></a>源码解析</h3><h4 id="网关-gateserver"><a href="#网关-gateserver" class="headerlink" title="网关 gateserver"></a>网关 gateserver</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">Main[Main] --&gt;|1.new|Watchdog(Watchdog)</span><br><span class="line">Watchdog --&gt;|2.new|Gate(Gate)</span><br><span class="line">Gate --&gt;|3.start|Gateserver(Gateserver)</span><br><span class="line">Main --&gt;|4.start|Watchdog</span><br><span class="line">Watchdog --&gt;|5.open|Gateserver</span><br><span class="line">Gateserver --&gt;|6.端口监听|Socket(Socket)</span><br><span class="line">Gateserver --&gt;|7.open|Gate</span><br><span class="line"></span><br><span class="line">Socket --&gt;|11.链接来了|Gateserver</span><br><span class="line">Gateserver --&gt;|12.opne|Gate</span><br><span class="line">Gate --&gt;|13.open|Watchdog</span><br><span class="line">Watchdog --&gt;|14.new|Agent(Agent)</span><br><span class="line">Watchdog --&gt;|15.start|Agent</span><br><span class="line">Agent --&gt;|16.forward|Gate</span><br><span class="line">Gate --&gt;|17.openclient|Gateserver</span><br><span class="line">Gateserver --&gt;|18.socketdriver.start|Socket</span><br><span class="line"></span><br><span class="line">Socket --&gt;|21.消息来了|Gateserver</span><br><span class="line">Gateserver --&gt;|22.message|Gate</span><br><span class="line">Gate --&gt;|23.socket data|Agent</span><br><span class="line"></span><br><span class="line">Socket --&gt;|31.连接关闭|Gateserver</span><br><span class="line">Gateserver --&gt;|32.disconnect|Gate</span><br><span class="line">Gate --&gt;|33.close|Watchdog</span><br><span class="line">Watchdog --&gt;|34.kick|Gate</span><br><span class="line">Gate --&gt;|35.closeclient|Gateserver</span><br><span class="line">Watchdog --&gt;|36.disconnect|Agent</span><br></pre></td></tr></table></figure>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44770127/article/details/107721768">网关服务</a></li>
<li><a target="_blank" rel="noopener" href="https://wudaijun.com/2015/02/skynet-socketserver/">skynet socketserver</a></li>
</ul>
<h4 id="登陆服务器-loginserver"><a href="#登陆服务器-loginserver" class="headerlink" title="登陆服务器 loginserver"></a>登陆服务器 loginserver</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">User[用户] --&gt;|1.发起认证请求 获取Token|A(认证平台)</span><br><span class="line">User[用户] --&gt;|2.选择服务器+Token 交换密钥|L(登陆服)</span><br><span class="line">L --&gt;|3.检查 Token合法性|A</span><br><span class="line">L --&gt;|4.转发登陆请求 密钥|G[游戏节点]</span><br><span class="line">G --&gt;|5.同步subid 作为登陆凭证 |L</span><br><span class="line">L --&gt;|6.同步subid|User</span><br><span class="line">User --&gt;|7.断开连接|L</span><br><span class="line">User --&gt;|8.链接后通讯|G</span><br></pre></td></tr></table></figure>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/cloudwu/skynet/wiki/LoginServer">官网LoginServer介绍</a></li>
</ul>
<h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://blog.codingnow.com/2012/09/the_design_of_skynet.html">Skynet 设计综述</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/cloudwu/skynet/wiki/GettingStarted">skynet 入门</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/cloudwu/skynet/wiki/LuaAPI">skynet LuaAPI</a></li>
<li><a target="_blank" rel="noopener" href="https://manistein.github.io/blog/post/server/skynet/skynet%E6%BA%90%E7%A0%81%E8%B5%8F%E6%9E%90/">skynet源码赏析</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Naivebug/skynet_gameserver_study">游戏例子</a></li>
<li><a target="_blank" rel="noopener" href="https://cloudwu.github.io/lua53doc/manual.html">Lua 5.3 参考手册</a></li>
<li><a target="_blank" rel="noopener" href="http://developer.egret.com/cn/github/egret-docs/Engine2D/projectConfig/installation/index.html">白鹭</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/14/erlang%E6%B1%87%E6%80%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="欣然">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="欣然的备忘录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/14/erlang%E6%B1%87%E6%80%BB/" class="post-title-link" itemprop="url">erlang汇总</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-04-14 09:26:33 / 修改时间：09:32:29" itemprop="dateCreated datePublished" datetime="2022-04-14T09:26:33+08:00">2022-04-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/erlang/" itemprop="url" rel="index"><span itemprop="name">erlang</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="常用启动参数"><a href="#常用启动参数" class="headerlink" title="常用启动参数"></a>常用启动参数</h4><p>启动方式： erl <argument>  argument有三种标签：</p>
<ol>
<li>虚拟机机标签，以+开头</li>
<li>系统标签，以-开头，这里有部分是启动标签，即启动时被调用如-s，其他为用户标签，存储在虚拟机内，通过init:get_argument(sname).可以得到，用户标签相当于在启动时设置了key-value值</li>
<li>计划标签，放在最前面，或在–，-extra之后，通过init:get_plain_arguments().获得</li>
</ol>
<p>常用参数如下：</p>
<ul>
<li>-detached <br><br>  用于运行守护或后台进程</li>
<li>-remsh Node <br><br>  连接到某个节点</li>
<li>-connect_all false<br>  禁止节点自动连通，且不能使用全局注册（global）</li>
<li>+sub true|false <br><br>  开启或关闭进程调度的负载平衡，默认false</li>
<li>+S Num <br><br>  开启smp时设置调度进程数量</li>
<li>+P Number <br><br>  设置进程数量上限</li>
<li>-setcookie <br><br>  指定cookie</li>
<li>-hidden <br><br>  设置为隐藏节点，在多节点中不会被其他节点自动连接，需要显示调用net_kernel:connect/1</li>
<li>+sub true <br><br>  开启调度程序负载平衡</li>
<li>-extra <br><br>  设置启动参数，通过init:get_plain_arguments/0获得</li>
<li>-config <br><br>  指定应用的配置，通过application:get_env/2获得</li>
<li>+pc unicode | latin1    <br><br>  启动时指定字符格式<ul>
<li>latin1：只有ISO-latin-1范围内的字符才能被认为是可打印的，这意味着代码点大于255的字符将永远不会被打印，并且包含此类字符的列表将被工具显示为整数列表，而不是文本字符串</li>
<li>unicode：在决定是否以字符串语法显示整数列表时，将考虑所有可打印的Unicode字符。这可能会带来意想不到的结果，例如，如果您的字体没有涵盖所有Unicode字符</li>
<li>io:printable_range().  查看shell的字符格式</li>
</ul>
</li>
<li>args_file FileName <br><br>  从一个文件里读取命令参数，注释以 # 开头，\ 作为引用符，禁止再嵌套-args_file FileName，在文件里，-extra被视为命令结束符</li>
<li>compile Mod1 Mod2 … <br><br>  编译模块</li>
<li>+sbwt none|very_short|short|medium|long|very_long <br><br>  设置调度程序繁忙等待阈值。默认为中。该阈值确定了在没有工作之前要进入睡眠状态的调度程序要等待多长时间</li>
<li>+Q Num <br><br>  erlang open_port的数量默认是65536，win为8192，若要超过这个数，则需要启动时用此参数指定，当然系统的限制也要打开，否则也是用不了的，可以通过erlang:system_info(port_limit) 来确认限制</li>
</ul>
<h4 id="编译选项"><a href="#编译选项" class="headerlink" title="编译选项"></a>编译选项</h4><ul>
<li>inline 开启自动内联函数，即把一些短小的函数内嵌到调用者函数体里面，减少函数调用的开销，默认大小为24，并不是指行数，可以通过{inline_size, Num}来改变大小，存在破坏尾递归的可能，也可以在源文件中用 <strong>-compile({inline, [Fun/Arty]}).</strong> 的方式显示指定哪个函数需要内联，但这种会被提示成old inline</li>
<li>debug_info 添加调试信息，加了这个可以由beam导出erl</li>
<li>warning_as_errors 警告当做错误输出</li>
<li>report 输出警告、错误信息</li>
<li>verbose 输出详细编译信息<br><a target="_blank" rel="noopener" href="https://www.erlang.org/doc/man/compile.html">其他</a></li>
</ul>
<h4 id="编程规范"><a href="#编程规范" class="headerlink" title="编程规范"></a><a target="_blank" rel="noopener" href="http://www.erlang.se/doc/programming_rules.shtml#REF19691">编程规范</a></h4><h5 id="官网推荐-基本要求"><a href="#官网推荐-基本要求" class="headerlink" title="官网推荐 = 基本要求"></a>官网推荐 = 基本要求</h5><ol>
<li>不要写深度嵌套代码</li>
<li>不要写非常大的模块，模块行数控制在1000行内</li>
<li>不要写很大的函数 尽量控制一个屏幕能显示完整</li>
<li>不要写太长的代码，太长时就换行</li>
<li>变量命名，驼峰式命名  后面跟数字的前面可以加’_’,以突出显示 如Player_2</li>
<li>函数名、模块名，单词以_分隔</li>
<li>代码间隔格式 ,后面加空格 看起来比较直观 如{12, 23, 45}<h5 id="附加"><a href="#附加" class="headerlink" title="附加"></a>附加</h5></li>
<li>不要在其他功能模块插入自己功能的一长段代码，应封装好后供其调用</li>
<li>功能目录下的模块命名前缀尽量跟目录名一致</li>
<li>涉及到玩家个人零点清次数的，要么用daily模块，要么state里存个更新时间T，根据T去判断要不要清次数或重置数据</li>
<li>任务监听的，生成配置时要列出改功能用到的任务标签，代码做判断时优先根据这标签列表做过滤</li>
<li>后面涉及到玩家个人零点清次数的，要么用daily模块，要么state里存个更新时间T，根据T去判断要不要清次数或重置数据，可以参考task_daily模块</li>
<li>会存机器人key的玩法，登陆初始化时要判断下key还在不在，因为每次重启时不能保证相同key的机器人还在</li>
</ol>
<h4 id="运维常用"><a href="#运维常用" class="headerlink" title="运维常用"></a>运维常用</h4><figure class="highlight erl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">recon:scheduler_usage(<span class="number">1000</span>).    <span class="comment">%% 查看一定时间内调度器程序使用率 参数为毫秒</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%% Type = used | allocated | unused | usage | allocated_types | allocated_instances</span></span><br><span class="line"><span class="comment">%% usage 使用率 = used/allocated</span></span><br><span class="line"><span class="comment">%% allocated 系统分配的</span></span><br><span class="line"><span class="comment">%% allocated_types 各种数据类型的占用</span></span><br><span class="line"><span class="comment">%% allocated_instances 调度程序占用，0代表所有</span></span><br><span class="line">recon_alloc:memory(Type).       <span class="comment">%% 内存查看 单位b</span></span><br><span class="line"></span><br><span class="line">reconcile:info(Pid). <span class="comment">%% 获取进程信息 类似process_info/1 但相对安全，不安全的如binary、dictionary、messages</span></span><br><span class="line"><span class="comment">%% 按Type值排序取前Num个进程的信息</span></span><br><span class="line"><span class="comment">%% Type = memory | message_queue_len | heap_size | binary_memory | reductions</span></span><br><span class="line"><span class="comment">%% 上述为常用选项，其实就是类似process_info里的key</span></span><br><span class="line">recon:proc_count(Type, Num).</span><br><span class="line">recon:proc_window(Type, Num, Milliseconds)  <span class="comment">%% 同上，但会在给定时间内采样两次取均值</span></span><br><span class="line"></span><br><span class="line">recon:port_types(). <span class="comment">%% 查看端口类型数量</span></span><br><span class="line">recon:port_info(<span class="string">&quot;#Port&lt;0.3440&gt;&quot;</span>).   <span class="comment">%% 查看端口信息</span></span><br><span class="line"><span class="comment">%% 查看按属性排序的前N个端口信息</span></span><br><span class="line"><span class="comment">%% Attribute = &#x27;recv_cnt&#x27; | &#x27;recv_oct&#x27; | &#x27;send_cnt&#x27; | &#x27;send_oct&#x27; | &#x27;cnt&#x27; | &#x27;oct&#x27;</span></span><br><span class="line"><span class="comment">%% oct：流量字节数，cnt包数</span></span><br><span class="line">recon:inet_count(Attribute, Num).</span><br><span class="line">recon:inet_window(Attribute, Count, Milliseconds). <span class="comment">%% 同上</span></span><br><span class="line"></span><br><span class="line">recon:bin_leak(N). <span class="comment">%% 对比gc前后binary内存变化，得出变化最大的N个进程</span></span><br><span class="line">recon_trace:calls(&#123;queue, in, <span class="number">2</span>&#125;, <span class="number">1</span>).   <span class="comment">%% 追踪函数调用</span></span><br><span class="line"></span><br><span class="line">rb:start() <span class="comment">%% 查看系统自带日志输出</span></span><br><span class="line">crashdump_viewer:start() <span class="comment">%% win端查看节点挂掉的dump文件</span></span><br><span class="line">observer:start()    <span class="comment">%% 具象化看节点信息</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">%% ets表占用内存排序</span></span><br><span class="line">lists:reverse(lists:keysort(<span class="number">2</span>, [&#123;Name, ets:info(Name, memory)&#125;||Name&lt;-ets:all()])).</span><br><span class="line"><span class="comment">%% 显示10秒内内核进程的使用率</span></span><br><span class="line">msacc:start(<span class="number">10000</span>),msacc:print().</span><br></pre></td></tr></table></figure>

<h4 id="dialyzer-静态分析"><a href="#dialyzer-静态分析" class="headerlink" title="dialyzer 静态分析"></a>dialyzer <a target="_blank" rel="noopener" href="https://erlangdisplay.iteye.com/blog/404570">静态分析</a></h4><p>使用示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dialyzer --build_plt -r &quot;C:\Program Files\erl7.3\lib\erts-7.3\ebin&quot; &quot;C:\Program Files\erl7.3\lib\kernel-4.2\ebin&quot; &quot;C:\Program Files\erl7.3\lib\stdlib-2.8\ebin&quot; &quot;C:\Program Files\erl7.3\lib\mnesia-4.13.3\ebin&quot; &quot;C:\Program Files\erl7.3\lib\crypto-3.6.3\ebin&quot; &quot;C:\Program Files\erl7.3\lib\sasl-2.7\ebin&quot;</span><br><span class="line">dialyzer -Werror_handling -r E:\work\cshx\server\script\../ebin &gt; </span><br></pre></td></tr></table></figure>
<h4 id="gen-server-exit"><a href="#gen-server-exit" class="headerlink" title="gen_server exit"></a>gen_server exit</h4><table>
<thead>
<tr>
<th>type</th>
<th>trap_exit</th>
<th>exit原因</th>
<th>进程终止否</th>
<th>teminate执行否</th>
</tr>
</thead>
<tbody><tr>
<td>gen_server</td>
<td>false</td>
<td>test、shutdown、kill、other</td>
<td>是</td>
<td>否</td>
</tr>
<tr>
<td>gen_server</td>
<td>false</td>
<td>normal</td>
<td>否</td>
<td>否</td>
</tr>
<tr>
<td>gen_server</td>
<td>true</td>
<td>normal、shutdown、test、other、killed</td>
<td>否</td>
<td>否</td>
</tr>
<tr>
<td>gen_server</td>
<td>true</td>
<td>kill</td>
<td>是</td>
<td>否</td>
</tr>
<tr>
<td>spawn</td>
<td>false</td>
<td>test、shutdown、kill、other</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>spawn</td>
<td>false</td>
<td>normal</td>
<td>否</td>
<td></td>
</tr>
<tr>
<td>spawn</td>
<td>true</td>
<td>kill、shutdown、test、other、killed</td>
<td>否</td>
<td></td>
</tr>
<tr>
<td>spawn</td>
<td>true</td>
<td>normal</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>ps：游戏节点终止会用init:stop/0,通知到gen_server退出的原因是shutdown</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="xrl-yrl-erlydtl"><a href="#xrl-yrl-erlydtl" class="headerlink" title="xrl yrl  erlydtl"></a>xrl yrl  erlydtl</h4><p><a target="_blank" rel="noopener" href="http://www.erlang.org/doc/man/leex.html">.xrl</a><br><a target="_blank" rel="noopener" href="http://www.erlang.org/doc/man/yecc.html">.yrl</a><br>具体看官方文档，大意是按一定规制写文件，然后可以用erlc编译生成.erl文件<br><br><a target="_blank" rel="noopener" href="http://www.erlang.org/doc/man/erlc.html">erlc可支持编译的文件格式</a></p>
<p>erlang模板引擎<br><br><a target="_blank" rel="noopener" href="https://github.com/erlydtl/erlydtl">https://github.com/erlydtl/erlydtl</a> <br><br><a target="_blank" rel="noopener" href="https://github.com/erlydtl/erlydtl/wiki">https://github.com/erlydtl/erlydtl/wiki</a>  例子</p>
<h4 id="运算符号"><a href="#运算符号" class="headerlink" title="运算符号"></a>运算符号</h4><table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
<th>参数类型</th>
</tr>
</thead>
<tbody><tr>
<td>‘+’</td>
<td>一元  +</td>
<td>number</td>
</tr>
<tr>
<td>‘-‘</td>
<td>一元  -</td>
<td>number</td>
</tr>
<tr>
<td>‘*’</td>
<td>乘法</td>
<td>number</td>
</tr>
<tr>
<td>‘/‘</td>
<td>浮点除法</td>
<td>number</td>
</tr>
<tr>
<td>div</td>
<td>整数除法</td>
<td>integer</td>
</tr>
<tr>
<td>bnot</td>
<td>一元 not 位运算</td>
<td>integer</td>
</tr>
<tr>
<td>rem</td>
<td>整数求余</td>
<td>integer</td>
</tr>
<tr>
<td>band</td>
<td>与运算</td>
<td>integer</td>
</tr>
<tr>
<td>bor</td>
<td>或运算</td>
<td>integer</td>
</tr>
<tr>
<td>bxor</td>
<td>异或运算</td>
<td>integer</td>
</tr>
<tr>
<td>bsl</td>
<td>左移运算</td>
<td>integer</td>
</tr>
<tr>
<td>bsr</td>
<td>右移运算</td>
<td>integer</td>
</tr>
</tbody></table>
<h4 id="全局宏"><a href="#全局宏" class="headerlink" title="全局宏"></a><a target="_blank" rel="noopener" href="http://erlang.org/doc/reference_manual/macros.html">全局宏</a></h4><table>
<thead>
<tr>
<th>宏名</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>?MODULE</td>
<td>atom</td>
<td>当前模块</td>
</tr>
<tr>
<td>?LINE</td>
<td>integer</td>
<td>当前行数</td>
</tr>
<tr>
<td>?FILE</td>
<td>string</td>
<td>当前文件名</td>
</tr>
<tr>
<td>?FUNCTION_NAME</td>
<td>atom</td>
<td>当前函数名</td>
</tr>
<tr>
<td>?FUNCTION_ARITY</td>
<td>integer</td>
<td>当前函数参数数量</td>
</tr>
<tr>
<td>?MACHINE</td>
<td>string</td>
<td>当前执行程序名 ‘BEAM’</td>
</tr>
<tr>
<td>?MODULE_STRING</td>
<td>string</td>
<td>当前模块</td>
</tr>
<tr>
<td>?OTP_RELEASE</td>
<td>integer</td>
<td>OTP版本 = erlang:system_info(otp_release) = 21</td>
</tr>
</tbody></table>
<h4 id="字符编码"><a href="#字符编码" class="headerlink" title="字符编码"></a>字符编码</h4><h5 id="源文件的编码"><a href="#源文件的编码" class="headerlink" title="源文件的编码"></a>源文件的编码</h5><p>编译器会用正则\s*[:=]\s*([-a-zA-Z0-9]检索erl文件头两行，若命中，则以声明的编码格式编译文件，R16B之前默认是Latin-1,之后是UTF-8。如可以用以下任意一种声明方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%% coding: utf-8</span><br><span class="line">%% For this file we have chosen encoding = Latin-1</span><br><span class="line">%% -*- coding: latin-1 -*-</span><br></pre></td></tr></table></figure>

<h5 id="位语法"><a href="#位语法" class="headerlink" title="位语法"></a>位语法</h5><p>Flag = utf8、utf16、utf32、little、big、binary</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;&lt;Ch/utf8,_/binary&gt;&gt; = Bin1,</span><br><span class="line">&lt;&lt;Ch/utf16-little,_/binary&gt;&gt; = Bin2,</span><br><span class="line">Bin3 = &lt;&lt;$H/utf32-little, $e/utf32-little, $l/utf32-little, $l/utf32-little,</span><br><span class="line">$o/utf32-little&gt;&gt;</span><br></pre></td></tr></table></figure>


<h4 id="erlang-system-monitor-MonitorPid-Options-gt-MonSettings"><a href="#erlang-system-monitor-MonitorPid-Options-gt-MonSettings" class="headerlink" title="erlang:system_monitor(MonitorPid, Options) -&gt; MonSettings"></a>erlang:system_monitor(MonitorPid, Options) -&gt; MonSettings</h4><p>监控某个进程，Options如下：<br></p>
<ul>
<li>{long_gc, Time} <br><br>若GC时间&gt;=Time,监控进程会收到{monitor, GcPid, long_gc, Info} <br><br>Info = [ {timeout, GcTime} | {Key, Val} ] <br><br>GcTime = 实际GC的毫秒数 Key = <br><ul>
<li>heap_size         堆容量</li>
<li>heap_block_size   堆栈容量</li>
<li>old_heap_size</li>
<li>old_heap_block_size</li>
<li>stack_size</li>
<li>recent_size       上次GC后的数据容量</li>
<li>mbuf_size         消息缓冲区容量</li>
<li>bin_vheap_size    从进程堆引用的唯一堆外二进制文件的总容量</li>
<li>bin_old_vheap_size </li>
<li>bin_vheap_block_size  GC前，虚拟堆中允许的二进制文件的容量上限</li>
<li>bin_old_vheap_block_size</li>
</ul>
</li>
<li>{long_schedule, Time} <br><br>若端口或进程在内核调用的时间&gt;=Time,则收到{monitor, PidOrPort, long_schedule, Info} <br><ul>
<li>被监控的是pid()时，Info内容有：<ul>
<li>{timeout, Millis}</li>
<li>{in, Location}</li>
<li>{out, Location} <br><br>Location = {Module, Function, Arity} | undefined</li>
</ul>
</li>
<li>被监控的是port()时 <br><br>可用于检测NIFs(内建函数)或驱动的运行时间，最好不要超过1ms，但在分时系统，只要&lt;100ms，都可以被认为正常<ul>
<li>{timeout, Millis}</li>
<li>{port_op,Op} <br><br>Op = proc_sig | timeout | input | output | event | dist_cmd</li>
</ul>
</li>
</ul>
</li>
<li>{large_heap, Size} <br><br>若GC后堆大小&gt;=Size，则收到{monitor, GcPid, large_heap, Info}，Info跟long_gc的一致，除了没有timeout<br><br>若被监控进程自身超过max_heap_size而被kill，则监控进程不会收到信息，因为其还没进行GC或GC完</li>
<li>busy_port <br><br>若被监控进程因为向繁忙端口发送消息而被挂机，则监控者收到{monitor, SusPid, busy_dist_port, Port}</li>
<li>busy_dist_port <br><br>同上，不同的是节点间的调用，{monitor, SusPid, busy_dist_port, Port}</li>
</ul>
<h4 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h4><p>内存块 18位对齐 所以最小256KB <br><br>载体 = 1~n个内存块 <br><br>堆分配器，二进制分配器，驱动程序分配器和ets分配器 <br><br>erl_alloc.types 具体的内存分配映射处理表,在源码中可见(erl_alloc.types) <br></p>
<p>内存增长的原因：</p>
<ol>
<li>消息队列过长</li>
<li>ets不规范操作</li>
<li>进程字典</li>
<li>binary数据引用</li>
</ol>
<h4 id="反编译"><a href="#反编译" class="headerlink" title="反编译"></a>反编译</h4><h4 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h4><ol>
<li>erlang c源码查看关联 如lists:reverse/1  = lists_reverse_1 <br><br>内建函数BIF表 = bif.tab</li>
<li>dict:fetch/2 用于查找已存在key的数据，不存在时会报错<br><br>dict:find/2 也是查找数据，不存在时返回error   </li>
<li>Erlang的binary分为两大类：ProcBin和Refc binary 。64 字节及以下的binary都直接在进程自己的堆上分配，其整个生命期都在堆中。大于 64 字节的binary会分配在一个binary专用的全局堆上，每个使用它的进程都会在自己的局部堆中持有一个对其的本地引用</li>
<li>erl_alloc.types 内存类型总览的源码文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">%%% -*- coding: utf8 -*-</span><br><span class="line">% 指定编译编码格式</span><br><span class="line"></span><br><span class="line">erlc -S 文件   %% 生成中间代码 .S文件</span><br><span class="line"></span><br><span class="line">% SHA256加密</span><br><span class="line">hmax_sha256(Key, Data)-&gt;</span><br><span class="line">    lists:flatten([[integer_to_list(N, 16) || &lt;&lt;N:4&gt;&gt; &lt;= crypto:hmac(sha256, Key, Data)]]).</span><br><span class="line">    </span><br><span class="line">-compile(&#123;parse_transform,ms_transform&#125;).</span><br><span class="line">erlang编译时，会先生成abstract_code，再回调这个参数指定的模块，最终生成vm执行的opccode</span><br><span class="line">也可以在emakefile中作为参数</span><br><span class="line">%% 查看abstract_code，编译时需用 debug_info参数</span><br><span class="line">&#123;ok,&#123;_,[&#123;abstract_code,&#123;_,AC&#125;&#125;]&#125;&#125; = beam_lib:chunks(filename:dirname(code:which(test)) ++ &quot;/test.beam&quot;,[abstract_code]).</span><br></pre></td></tr></table></figure>



<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><ol>
<li>erlang的缺陷<ol>
<li>使用耗时的nif时，会影响其调度公平</li>
<li>存在进程字典、ets，妨碍了函数式的幂等性</li>
</ol>
</li>
</ol>
<h4 id="其他文档"><a href="#其他文档" class="headerlink" title="其他文档"></a>其他文档</h4><ul>
<li><a target="_blank" rel="noopener" href="https://www.processon.com/view/link/5c3d4a55e4b0641c83dc0772#map">cowboy websocket分析</a></li>
<li><a target="_blank" rel="noopener" href="https://code.google.com/p/mypeb/downloads/list">php使用erlang</a></li>
<li><a target="_blank" rel="noopener" href="http://erlang.org/doc/apps/erts/erl_ext_dist.html">erlang数据结构的二进制表示</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/u011583927/article/details/80905740">SHA256算法原理详解</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40811410/article/details/81950142">Base64 的原理、实现及应用</a></li>
<li><a target="_blank" rel="noopener" href="https://www.iteye.com/blog/jzhihui-1482175">Erlang并发机制 –进程调度</a></li>
<li><a target="_blank" rel="noopener" href="https://www.iteye.com/blog/mryufeng-334744">Erlang ERTS的Trap机制的设计及其用途</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/softn/article/details/51872232">软实时和硬实时操作系统的区别</a> <br>如果系统响应不能满足时限的要求，即使它能得到正确的输出，我们也只能说他是一个失败的响应。“软”意味着如果没有满足指定的时间约束并不会导致灾难性后果，而对硬实时系统来说却是灾难性的</li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/qHJiTjpvDikFcdl9SRL97Q">深入理解 MySQL 索引底层原理</a></li>
<li><a target="_blank" rel="noopener" href="https://www.iteye.com/blog/jzhihui-1506756">Erlang并发机制 – 消息传递</a></li>
<li><a target="_blank" rel="noopener" href="http://beam-wisdoms.clau.se/en/latest/indepth-memory-layout.html">Erlang类型数据的内存存储格式</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/me-sa/archive/2012/01/09/erlang0029.html">Erlang Inline编译 内联函数</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/mycwq/article/details/28660813">分析和解决mnesia过载问题</a></li>
<li><a target="_blank" rel="noopener" href="https://wudaijun.com/2015/12/erlang-datastructures/">Erlang 常用数据结构实现</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/mycwq/article/details/26613275">Erlang进程堆垃圾回收机制</a></li>
<li><a target="_blank" rel="noopener" href="https://hamidreza-s.github.io/erlang%20garbage%20collection%20memory%20layout%20soft%20realtime/2015/08/24/erlang-garbage-collection-details-and-why-it-matters.html">Erlang垃圾回收细节</a></li>
</ul>
<h4 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h4><ul>
<li><a target="_blank" rel="noopener" href="http://erlang.shiningray.cn/otp-design-principles/index.html">Erlang OTP 设计原理文档</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/me-sa/">坚强2002的博客</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.yufeng.info/">系统技术非业余研究</a></li>
<li><a target="_blank" rel="noopener" href="https://www.iteye.com/blog/user/mryufeng">yufeng原博客</a></li>
<li><a target="_blank" rel="noopener" href="https://erlangdisplay.iteye.com/category/127758">成立涛的博客</a></li>
<li><a target="_blank" rel="noopener" href="http://gashero.yeax.com/?cat=6">惊帆之静默</a></li>
<li><a target="_blank" rel="noopener" href="https://cryolite.iteye.com/category/30938?page=2">cryolite</a></li>
<li><a target="_blank" rel="noopener" href="https://wudaijun.com/">wudaijun</a></li>
<li><a target="_blank" rel="noopener" href="https://www.yuque.com/mouwen/weekly/qa">Erlang/Elixir精选</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.erlang.org/">Erlang开发组博客</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/erlware/Erlang-and-OTP-in-Action-Source">Erlang-and-OTP-in-Action</a></li>
<li><a target="_blank" rel="noopener" href="http://trapexit.org/">http://trapexit.org</a> （国内封锁）</li>
<li><a target="_blank" rel="noopener" href="https://github.com/0xAX/erlang-bookmarks/blob/master/ErlangBookmarks.md">erlang书签</a></li>
<li><a target="_blank" rel="noopener" href="https://iowiki.com/erlang/erlang_index.html">erlang 教程wiki</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/hstcscolor/awesome-erlang-cn">Erlang资源大全中文版</a></li>
<li><a target="_blank" rel="noopener" href="https://sites.google.com/a/chaoskey.com/erlang/">Erlang程序设计</a></li>
<li><a target="_blank" rel="noopener" href="https://erldoc.com/">Erlang中文手册</a></li>
<li><a target="_blank" rel="noopener" href="https://szpzs.oschina.io/categories/">彭政生的博客</a></li>
<li><a target="_blank" rel="noopener" href="https://ferd.ca/">learn you some erlang作者博客</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/13/linux%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="欣然">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="欣然的备忘录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/13/linux%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/" class="post-title-link" itemprop="url">linux常用指令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-04-13 16:21:05 / 修改时间：16:22:45" itemprop="dateCreated datePublished" datetime="2022-04-13T16:21:05+08:00">2022-04-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">screen -X -S 20153 quit  <span class="comment">## 退出</span></span><br><span class="line">screen -<span class="built_in">ls</span>               <span class="comment">## 查看在运行的</span></span><br><span class="line">screen -r Id|name        <span class="comment">## 跳到指定界面</span></span><br><span class="line">screen -D                <span class="comment">## 踢掉正在查看的用户</span></span><br></pre></td></tr></table></figure>

<h3 id="rsync"><a href="#rsync" class="headerlink" title="rsync"></a>rsync</h3><p><a target="_blank" rel="noopener" href="https://www.itefix.net/cwrsync">win版本</a> <br><br><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/692451">centos7安装配置rsync以及遇到问题</a> <br><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/reve-wang/p/7216582.html">RSYNC常见问题及解决办法</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">## linux服务端 /etc/rsyncd.conf配置</span><br><span class="line">uid=root</span><br><span class="line">gid=root</span><br><span class="line">use chroot = no</span><br><span class="line">max connections = 4</span><br><span class="line">strict modes =no</span><br><span class="line">port = 873</span><br><span class="line">address = 192.168.1.111</span><br><span class="line">log file=/var/log/rsync.log</span><br><span class="line"></span><br><span class="line">[admin_web]</span><br><span class="line">path = /data/admin/web/dist</span><br><span class="line">comment = admin web</span><br><span class="line">ignore errors</span><br><span class="line">read only = no</span><br><span class="line">list = no</span><br><span class="line">auth user=test</span><br><span class="line">secrets file = /etc/rsync.pas</span><br><span class="line">transfer logging = yes</span><br><span class="line">pid file = /var/run/rsyncd.pid</span><br><span class="line">lock file = /var/run/rsync.lock</span><br><span class="line">hosts allow = 192.168.1.0/255.255.255.0</span><br><span class="line">hosts deny = *</span><br><span class="line"></span><br><span class="line">UID = 0</span><br><span class="line">GID = 0</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/rsync.pas 文件内容</span><br><span class="line">test:rsync      ## 用户:密码</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rsync --daemon  <span class="comment">## 启动后台服务</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不用后台的同步方式</span></span><br><span class="line">rsync -avz --progress -e <span class="string">&quot;ssh -i ~/.shh/id_rsa.pub&quot;</span> /data/code/ebin/ root@121.37.19.201:/data/ebin_rsync</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rem window同步示例</span><br><span class="line">rsync -avz --port=873 --chmod=777 --delete --password-file=d:/passwd dist/ 192.168.1.111::admin_web/</span><br></pre></td></tr></table></figure>


<table>
<thead>
<tr>
<th>命令参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>–progress</td>
<td>显示传输过程</td>
</tr>
<tr>
<td>-avz</td>
<td>z:压缩 v:显示传输文件名 a:归档模式(= -rlptgoD)</td>
</tr>
<tr>
<td>-exclude=”文件/目录”</td>
<td>排除指定文件或目录</td>
</tr>
</tbody></table>
<h3 id="find"><a href="#find" class="headerlink" title="find"></a>find</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find / -ctime -1  ## 查找1天内被修改过的文件</span><br><span class="line">find / -cmin -60  ## 查找60分钟内被修改过的文件</span><br></pre></td></tr></table></figure>

<h3 id="grep"><a href="#grep" class="headerlink" title="grep"></a><a target="_blank" rel="noopener" href="https://www.runoob.com/linux/linux-comm-grep.html">grep</a></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep -参数 &quot;内容&quot; 待搜索的内容或文件   </span><br><span class="line">-n 显示行号</span><br></pre></td></tr></table></figure>
<h3 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -i s/Search/Replace/g File  ## 替换该文件所有匹配到的为所要替换的</span><br><span class="line">## 实例</span><br><span class="line">sed -i s/&quot;case &#x27;Mac&#x27;&quot;/&quot;case &#x27;Mac&#x27;,&#x27;Linux&#x27;&quot;/g ../../../Build/SubPackages/Modules/*/hxscript/Compile.hx</span><br></pre></td></tr></table></figure>

<h3 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h3><p>client 没有密钥时可用下面指令生成 <br><br>密钥要放在 ~/.ssh 下面，且名字未id_rsa.pub、id_rsa <br><br>因为ssh登陆其他机器是，会默认按这个名字去取私钥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t [rsa|dsa] -C <span class="string">&quot;comments&quot;</span></span><br><span class="line"><span class="comment"># -t 可选择RSA 和 DSA 两种密钥</span></span><br><span class="line"><span class="comment"># -C 可选注释</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登陆指定机器示例</span></span><br><span class="line">ssh -p 22 192.168.1.111</span><br></pre></td></tr></table></figure>

<h3 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## 查看监听的端口</span><br><span class="line">netstat -nltp</span><br><span class="line">## 查看所有的tcp连接</span><br><span class="line">netstat -t</span><br></pre></td></tr></table></figure>


<h3 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a>iptables</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/liang2580/articles/8400140.html">https://www.cnblogs.com/liang2580/articles/8400140.html</a></p>
<ul>
<li>表（tables）<ul>
<li>filter 负责过滤功能，防火墙；内核模块：iptables_filter</li>
<li>raw 关闭nat表上启用的连接追踪机制；iptable_raw</li>
<li>nat network address translation，网络地址转换功能；内核模块：iptable_nat</li>
<li>mangle 拆解报文，做出修改，并重新封装 的功能；iptable_mangle</li>
</ul>
</li>
<li>链（chains）<ul>
<li>PREROUTING  路由前</li>
<li>INPUT     进入     </li>
<li>FORWARD       转发  </li>
<li>OUTPUT    出去</li>
<li>POSTROUTING 路由后</li>
</ul>
</li>
<li>规则（policy）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">## 启动、重启、停止服务</span><br><span class="line">/etc/init.d/iptables start | restart | stop</span><br><span class="line">service iptable save | start | restart</span><br><span class="line">## 查看规则</span><br><span class="line">Iptables –L –n</span><br><span class="line">## 开放端口</span><br><span class="line">iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 23 -j ACCEPT</span><br><span class="line">## 禁止端口</span><br><span class="line">iptables -A INPUT -p tcp --dport 22 -j DROP</span><br></pre></td></tr></table></figure>



<h3 id="xarges"><a href="#xarges" class="headerlink" title="xarges"></a>xarges</h3><p><a target="_blank" rel="noopener" href="https://www.runoob.com/linux/linux-comm-xargs.html">xargs</a> 可以将管道或标准输入（stdin）数据转换成命令行参数，也能够从文件的输出中读取数据。</p>
<p>xargs 也可以将单行或多行文本输入转换为其他格式，例如多行变单行，单行变多行。</p>
<p>xargs 默认的命令是 echo，这意味着通过管道传递给 xargs 的输入将会包含换行和空白，不过通过 xargs 的处理，换行和空白将被空格取代。</p>
<p>xargs 是一个强有力的命令，它能够捕获一个命令的输出，然后传递给另外一个命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 多行变当行输出</span></span><br><span class="line"><span class="built_in">cat</span> test.txt | xargs</span><br><span class="line">a b c d e f g h i j k l m n o p q r s t u v w x y z</span><br><span class="line"></span><br><span class="line"><span class="comment">## -n 选项多行输出：</span></span><br><span class="line"><span class="built_in">cat</span> test.txt | xargs -n3</span><br><span class="line">a b c</span><br><span class="line">d e f</span><br><span class="line">g h i</span><br></pre></td></tr></table></figure>


<h3 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">## 显示正在运行的任务</span><br><span class="line">crontab -l</span><br><span class="line"></span><br><span class="line">## 重启</span><br><span class="line">service crond restart</span><br><span class="line"></span><br><span class="line">## 查看状态</span><br><span class="line">service crond status</span><br><span class="line"></span><br><span class="line">crontab任务配置基本格式：</span><br><span class="line">*   *　 *　 *　 *　　command</span><br><span class="line">分钟(0-59)　小时(0-23)　日期(1-31)　月份(1-12)　星期(0-6,0代表星期天)　 命令</span><br><span class="line">第1列表示分钟1～59 每分钟用*或者 */1表示</span><br><span class="line">第2列表示小时1～23（0表示0点）</span><br><span class="line">第3列表示日期1～31</span><br><span class="line">第4列表示月份1～12</span><br><span class="line">第5列标识号星期0～6（0表示星期天）</span><br><span class="line">第6列要运行的命令</span><br></pre></td></tr></table></figure>

<ul>
<li>在以上任何值中，星号（*）可以用来代表所有有效的值。譬如，月份值中的星号意味着在满足其它制约条件后每月都执行该命令。</li>
<li>整数间的短线（-）指定一个整数范围。譬如，1-4 意味着整数 1、2、3、4。</li>
<li>用逗号（,）隔开的一系列值指定一个列表。譬如，3, 4, 6, 8 标明这四个指定的整数。</li>
<li>正斜线（/）可以用来指定间隔频率。在范围后加上 /<integer> 意味着在范围内可以跳过 integer。譬如，0-59/2 可以用来在分钟字段定义每两分钟。间隔频率值还可以和星号一起使用。例如，*/3 的值可以用在月份字段中表示每三个月运行一次任务。<br>开头为井号（#）的行是注释，不会被处理。 </li>
</ul>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 检索已安装的程序</span></span><br><span class="line">rpm -qa |grep erlang</span><br><span class="line"><span class="comment">## 查看软件包的安装路径</span></span><br><span class="line">rpm -ql 软件包名</span><br><span class="line"><span class="comment">## 安装</span></span><br><span class="line">rpm -ivh esl-erlang_21.1-1_centos_6_amd64.rpm --force --nodeps</span><br></pre></td></tr></table></figure>



<h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">## 查询数据库存在否</span><br><span class="line">SELECT SCHEMA_NAME FROM information_schema.SCHEMATA WHERE SCHEMA_NAME = &#x27;c_local_1&#x27;</span><br><span class="line">## 查看表结构</span><br><span class="line">desc 表名</span><br><span class="line">## 查看创建表的语句</span><br><span class="line">show create table 表名</span><br></pre></td></tr></table></figure>

<h3 id="more"><a href="#more" class="headerlink" title="more"></a>more</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Enter 向下n行，需要定义。默认为1行</span><br><span class="line">Ctrl+F 向下滚动一屏</span><br><span class="line">空格键 向下滚动一屏</span><br><span class="line">Ctrl+B 返回上一屏</span><br><span class="line">= 输出当前行的行号</span><br><span class="line">：f 输出文件名和当前行的行号</span><br><span class="line">V 调用vi编辑器</span><br><span class="line">!命令 调用Shell，并执行命令</span><br><span class="line">q 退出more</span><br></pre></td></tr></table></figure>

<h3 id="ansible"><a href="#ansible" class="headerlink" title="ansible"></a><a target="_blank" rel="noopener" href="http://www.ansible.com.cn/">ansible</a></h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/keerya/p/7987886.html#_label4_2">命令详解</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## 测试是否连通</span><br><span class="line">ansible 服务器组名 -m ping</span><br><span class="line">## 在指定服务器上执行shell命令</span><br><span class="line">ansible SrvName -m shell -a &quot;command string&quot;</span><br></pre></td></tr></table></figure>

<h3 id="svn-git"><a href="#svn-git" class="headerlink" title="svn git"></a>svn git</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 递归恢复</span></span><br><span class="line">svn  revert -R 目录</span><br><span class="line"><span class="comment">## 查看最新5条日志</span></span><br><span class="line">svn <span class="built_in">log</span> -l 5 -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化一个git仓库</span></span><br><span class="line">git init --bare runoob.git</span><br><span class="line"><span class="comment"># 在已有文件夹中关联一个git仓库</span></span><br><span class="line">git init </span><br><span class="line">git remote add origin 地址</span><br><span class="line"><span class="comment"># 下载指定版本(分支)</span></span><br><span class="line">git <span class="built_in">clone</span> -b 分支名称 地址</span><br></pre></td></tr></table></figure>

<h3 id="gcc"><a href="#gcc" class="headerlink" title="gcc"></a>gcc</h3><ul>
<li>-fPIC与-fpic都是在编译时加入的选项，用于生成位置无关的代码(Position-Independent-Code)。这两个选项都是可以使代码在加载到内存时使用相对地址，所有对固定地址的访问都通过全局偏移表(GOT)来实现。-fPIC和-fpic最大的区别在于是否对GOT的大小有限制。-fPIC对GOT表大小无限制，所以如果在不确定的情况下，使用-fPIC是更好的选择。</li>
<li>-fPIE与-fpie是等价的。这个选项与-fPIC/-fpic大致相同，不同点在于：-fPIC用于生成动态库，-fPIE用与生成可执行文件。再说得直白一点：-fPIE用来生成位置无关的可执行代码。</li>
<li>-w 关闭编译时的警告</li>
<li>-Wall 显示所有警告</li>
</ul>
<h3 id="常用指令"><a href="#常用指令" class="headerlink" title="常用指令"></a>常用指令</h3><h4 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查看系统版本</span><br><span class="line">cat /etc/redhat-release </span><br><span class="line"># 统计当前目录各个项所占磁盘大小</span><br><span class="line"> du -sh *</span><br><span class="line"> # 统计错误日志模块函数出现的频率</span><br><span class="line"> grep &#x27;[E]&#x27; error_log.*|awk -F\( &#x27;&#123;a[$1]+=1&#125; END &#123;for (i in a) print a[i],i&#125;&#x27;|sort -rn</span><br></pre></td></tr></table></figure>



<h4 id="性能调优"><a href="#性能调优" class="headerlink" title="性能调优"></a>性能调优</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##### 查看内存前10的进程</span></span><br><span class="line">ps aux|<span class="built_in">head</span> -1;ps aux|grep -v PID|<span class="built_in">sort</span> -rn -k +4|<span class="built_in">head</span></span><br><span class="line"><span class="comment">##### 清缓存</span></span><br><span class="line"><span class="built_in">echo</span> 3 &gt; /proc/sys/vm/drop_caches</span><br></pre></td></tr></table></figure>



      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/13/erlang%20trace%E4%BA%86%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="欣然">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="欣然的备忘录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/13/erlang%20trace%E4%BA%86%E8%A7%A3/" class="post-title-link" itemprop="url">erlang trace 了解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-04-13 16:15:25 / 修改时间：16:18:38" itemprop="dateCreated datePublished" datetime="2022-04-13T16:15:25+08:00">2022-04-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/erlang/" itemprop="url" rel="index"><span itemprop="name">erlang</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>erlang trace机制提供了一套消息发送接收、函数调用、垃圾收集、端口开闭的追踪方法</p>
<p>现在Erlang用于Trace的库有：</p>
<ul>
<li>sys 是一个标准的OTP， 可以允许自 定义trace函数， 记录所有类型的事件等等。 它非常完善且可以很好地用于开发。 但它会稍微影响处于生产 环境的系统， 因为它没有把IO重定向到远程的shell中， 而且他没有限制trace消息的速度。 不过还是推荐阅读其文档模块。</li>
<li>dbg 也是一个标准的OTP。 它的接口在可用性方面显得有点笨拙。 但它完全足以满足你所需。 问 题在于： 你必须要知道你要做什么,因为 dbg可以记录一切， 并在2秒内把系统搞崩溃。</li>
<li>tracing BIFs作为一个Erang的模块可用。 它们大多作为原始块(the raw blocks)由这个列表中提到的application所调用,但由于他们处于较底层， 比较抽象， 用起来也非常困难。</li>
<li>redbug 是可以在正式的生产 运行系统中使用的trace库， 是eper 的一部分， 它内部有一个速度限制开关， 和一个不错的可用接口。 为了使用它， 你必须把eper的所有依赖项都加上。 这个工具箱非常全面， 你会体验到一次非常有趣的安装。</li>
<li>recon_trace 是recon中负 责trace的模块。 目的是和redbug有相同的安全水平,但却不要这么多的依赖项。 接口也不一样， 速度限制选项并不完全相同。 它可以只trace指定的函数调用， 没有trace send/recv message （实际在使用OTP的application里面根本没有必要支持trace message这种机制）</li>
</ul>
<h4 id="1-redbug的使用"><a href="#1-redbug的使用" class="headerlink" title="1. redbug的使用"></a>1. redbug的使用</h4><p><a target="_blank" rel="noopener" href="https://github.com/massemanet/redbug">项目地址</a></p>
<p>基于erlang trace机制实现的，跟踪函数调用并输出的方法库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">% 监听模块函数</span><br><span class="line">redbug:start(&quot;Module:Func&quot;).</span><br><span class="line">% 监听模块函数并打印结果 </span><br><span class="line">redbug:start(&quot;Module:Func-&gt;return&quot;).</span><br><span class="line">% 监听模块函数并打印调用堆栈</span><br><span class="line">redbug:start(&quot;Module:Func-&gt;stack&quot;).</span><br><span class="line"></span><br><span class="line">监听格式 &lt;MFA&gt; when &lt;guard&gt; -&gt; &lt;action&gt;</span><br><span class="line">MFA = Mod | Mod:Fun | Mod:Fun/Arity | Mod:Fun(_, atom, X)</span><br><span class="line">guard = is_atom(X) | X == 1</span><br><span class="line">action = return | stack | return;stack</span><br></pre></td></tr></table></figure>

<p>第二参数选项</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>默认</th>
<th>释义</th>
</tr>
</thead>
<tbody><tr>
<td>msgs</td>
<td>10</td>
<td>条数</td>
</tr>
<tr>
<td>time</td>
<td>15000</td>
<td>持续时间</td>
</tr>
<tr>
<td>procs</td>
<td>all</td>
<td>all 或 指定的pid列表</td>
</tr>
<tr>
<td>records</td>
<td>[]</td>
<td>模块名列表，从其取出record</td>
</tr>
<tr>
<td>print_file</td>
<td>“”</td>
<td>打印输出文件，默认为standard_io(屏幕)</td>
</tr>
<tr>
<td>print_mesc</td>
<td>false</td>
<td>显示时间精确到毫秒否</td>
</tr>
<tr>
<td>print_return</td>
<td>true</td>
<td>显示返回值否</td>
</tr>
<tr>
<td>print_fun</td>
<td>‘’</td>
<td>自定义显示函数</td>
</tr>
<tr>
<td>arity</td>
<td>false</td>
<td>true:显示参数个数 false:显示参数详细</td>
</tr>
</tbody></table>
<h4 id="2-recon-trace的使用"><a href="#2-recon-trace的使用" class="headerlink" title="2. recon_trace的使用"></a>2. recon_trace的使用</h4><p>以安全的方式监听单个erlang节点的函数调用，会创建一个进程去收集信息并处理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">recon_trace:calls(TSpecs::tspec() | [tspec(), ...], Max::max(), Opts::options()) -&gt; num_matches()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">recon_trace:call(&#123;dev, online, &#x27;_&#x27;&#125;, 100, []).</span><br><span class="line">% 带返回结果</span><br><span class="line">recon_trace:call(&#123;dev, online,  return_trace&#125;, 100, []).</span><br><span class="line">% 自定义输出打印 A = &#123;trace, Pid, call, &#123;M, F, A&#125;&#125;</span><br><span class="line">recon_trace:call(&#123;dev, online, &#x27;_&#x27;&#125;, 100, [&#123;formatter, fun(A)-&gt; io_lib:format(&quot;&quot;, [A]) end&#125;]).</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>参数</th>
<th>默认</th>
<th>释义</th>
</tr>
</thead>
<tbody><tr>
<td>scope</td>
<td>global</td>
<td>local:跟踪包括本地调用 global:只限mfa的调用</td>
</tr>
<tr>
<td>formatter</td>
<td>recon_trace:format/1</td>
<td>自定义消息打印格式</td>
</tr>
<tr>
<td>pid</td>
<td>all</td>
<td>指定监听的进程，all=所有 new=开始监听后创建的</td>
</tr>
<tr>
<td>io_server</td>
<td>“”</td>
<td>指定输出的文件，为空时则为当前的shell</td>
</tr>
<tr>
<td>args</td>
<td>args</td>
<td>args=显示详细参数 arity=显示参数个数</td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="http://ferd.github.io/recon/recon_trace.html#type-args">文档</a></p>
<h4 id="3-用途"><a href="#3-用途" class="headerlink" title="3. 用途"></a>3. 用途</h4><p>线上环境加输出打印不易，可以用recon_trace做动态输出打印</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/13/hexo%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="欣然">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="欣然的备忘录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/13/hexo%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">hexo入门</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-04-13 14:25:54 / 修改时间：16:05:30" itemprop="dateCreated datePublished" datetime="2022-04-13T14:25:54+08:00">2022-04-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="快速使用"><a href="#快速使用" class="headerlink" title="快速使用"></a>快速使用</h3><table>
<thead>
<tr>
<th>指令</th>
<th>释义</th>
</tr>
</thead>
<tbody><tr>
<td>hexo g</td>
<td>生成</td>
</tr>
<tr>
<td>hexo s</td>
<td>本地部署预览</td>
</tr>
<tr>
<td>hexo d</td>
<td>发布</td>
</tr>
<tr>
<td>hexo clean</td>
<td>清除缓存</td>
</tr>
<tr>
<td>hexo n 文章名</td>
<td>创建一个新的文章模板</td>
</tr>
<tr>
<td>hexo new page tags</td>
<td>生成标签索引界面</td>
</tr>
<tr>
<td>hexo new page categories</td>
<td>生成分类索引界面</td>
</tr>
</tbody></table>
<h3 id="next主题配置"><a href="#next主题配置" class="headerlink" title="next主题配置"></a>next主题配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">menu:</span><br><span class="line">  home: / || fa fa-home</span><br><span class="line">  #about: /about/ || fa fa-user</span><br><span class="line">  tags: /tags/ || fa fa-tags</span><br><span class="line">  categories: /categories/ || fa fa-th</span><br><span class="line">  archives: /archives/ || fa fa-archive</span><br><span class="line">codeblock:</span><br><span class="line">  # Code Highlight theme 设置代码块主题</span><br><span class="line">  # Available values: normal | night | night eighties | night blue | night bright | solarized | solarized dark | galactic</span><br><span class="line">  # See: https://github.com/chriskempson/tomorrow-theme</span><br><span class="line">  highlight_theme: night</span><br></pre></td></tr></table></figure>

<h3 id="站点配置"><a href="#站点配置" class="headerlink" title="站点配置"></a>站点配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Deployment</span><br><span class="line">## Docs: https://hexo.io/zh-cn/docs/one-command-deployment</span><br><span class="line">deploy:</span><br><span class="line">  type: &#x27;git&#x27;</span><br><span class="line">  repo: &lt;repository url&gt; #https://bitbucket.org/JohnSmith/johnsmith.bitbucket.io</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure>

<h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><p><a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/configuration">hexo官方指南</a><br><a target="_blank" rel="noopener" href="http://theme-next.iissnan.com/getting-started.html">next主题使用文档</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/13/erlang%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="欣然">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="欣然的备忘录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/13/erlang%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D/" class="post-title-link" itemprop="url">erlang工具介绍</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-13 15:06:47" itemprop="dateCreated datePublished" datetime="2022-03-13T15:06:47+08:00">2022-03-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-13 15:45:58" itemprop="dateModified" datetime="2022-04-13T15:45:58+08:00">2022-04-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/erlang/" itemprop="url" rel="index"><span itemprop="name">erlang</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="1-observer-start"><a href="#1-observer-start" class="headerlink" title="1. observer:start()"></a>1. observer:start()</h4><p>官方系统监视工具，最强最全，但只能在window下运行，可惜正式部署环境大多为Linux，且不与外界节点联通，导致只能在开发周期使用       </p>
<h4 id="2-crashdump-viewer-start"><a href="#2-crashdump-viewer-start" class="headerlink" title="2. crashdump_viewer:start()"></a>2. crashdump_viewer:start()</h4><p>官方对崩溃日志（erl_crash.dump）的解析工具       </p>
<h4 id="3-observer-cli-start"><a href="#3-observer-cli-start" class="headerlink" title="3. observer_cli:start()"></a>3. observer_cli:start()</h4><p>文字窗口版本的observer       </p>
<h4 id="4-erlangpl"><a href="#4-erlangpl" class="headerlink" title="4.  erlangpl"></a>4.  erlangpl</h4><p>escript ./erlangpl -n Node -c Cookie                </p>
<p>网页版系统信息监控，需要能联通监视节点        </p>
<p><a target="_blank" rel="noopener" href="https://github.com/erlanglab/erlangpl">项目地址</a></p>
<h4 id="5-debugger"><a href="#5-debugger" class="headerlink" title="5. debugger"></a>5. debugger</h4><p>debugger:start().</p>
<ul>
<li>win下界面版断点调试、信息匹配跟踪                </li>
<li>断点单进程比较合适，多进程并发服务器就不怎么适用了                </li>
<li>信息匹配追踪，较难上手，比较适合通过命令方式在正式场景动态追踪问题        </li>
</ul>
<h4 id="6-dialyzer"><a href="#6-dialyzer" class="headerlink" title="6. dialyzer"></a>6. dialyzer</h4><p>静态分析工具，代码错误检查鸡肋工具，会有较多的非错误性输出        </p>
<h4 id="7-reltool"><a href="#7-reltool" class="headerlink" title="7. reltool"></a>7. reltool</h4><p>todo 发布工具        </p>
<h4 id="8-运行时工具"><a href="#8-运行时工具" class="headerlink" title="8. 运行时工具"></a>8. 运行时工具</h4><ol>
<li>dbg<br> todo 信息追踪                </li>
<li>dyntrace<br>  todo 信息追踪</li>
<li>erts_alloc_config<pre><code> 内存分配配置
</code></pre>
</li>
<li>msacc<pre><code> 调度\IO进程利用率查看
</code></pre>
</li>
<li>scheduler<pre><code> 调度进程
</code></pre>
</li>
<li>system_infomation<pre><code> 系统信息
</code></pre>
</li>
</ol>
<h4 id="9-Syntax-Tool-标签工具"><a href="#9-Syntax-Tool-标签工具" class="headerlink" title="9. Syntax_Tool  标签工具"></a>9. Syntax_Tool  标签工具</h4><ol>
<li>prettypr<br> 输出美化</li>
</ol>
<h4 id="10-cover-覆盖分析"><a href="#10-cover-覆盖分析" class="headerlink" title="10. cover 覆盖分析"></a>10. cover 覆盖分析</h4><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">% 启动引用</span></span><br><span class="line">cover:start().</span><br><span class="line"><span class="comment">% 编译所要分析的模块</span></span><br><span class="line">cover:compile_beam(Module).</span><br><span class="line"><span class="comment">% 执行测试代码</span></span><br><span class="line"><span class="comment">% 覆盖分析</span></span><br><span class="line">cover:analyse(Module, coverrage, module | funcation | clause | line) -&gt; &#123;ok,  list()&#125;</span><br><span class="line"><span class="comment">% 调用次数分析</span></span><br><span class="line">cover:analyse(Module, calls, module | funcation | clause | line) -&gt; &#123;ok,  list()&#125;</span><br><span class="line"><span class="comment">% 输出到文件</span></span><br><span class="line">cover:analyse_to_file(Module).</span><br></pre></td></tr></table></figure>

<h4 id="11-redbug"><a href="#11-redbug" class="headerlink" title="11. redbug"></a>11. redbug</h4><p><a target="_blank" rel="noopener" href="https://github.com/massemanet/redbug">项目地址</a></p>
<p>基于erlang trace机制实现的，跟踪函数调用并输出的方法库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">% 监听模块函数</span><br><span class="line">redbug:start(&quot;Module:Func&quot;).</span><br><span class="line">% 监听模块函数并打印结果 </span><br><span class="line">redbug:start(&quot;Module:Func-&gt;return&quot;).</span><br><span class="line">% 监听模块函数并打印调用堆栈</span><br><span class="line">redbug:start(&quot;Module:Func-&gt;stack&quot;).</span><br><span class="line"></span><br><span class="line">监听格式 &lt;MFA&gt; when &lt;guard&gt; -&gt; &lt;action&gt;</span><br><span class="line">MFA = Mod | Mod:Fun | Mod:Fun/Arity | Mod:Fun(_, atom, X)</span><br><span class="line">guard = is_atom(X) | X == 1</span><br><span class="line">action = return | stack | return;stack</span><br></pre></td></tr></table></figure>

<p>第二参数选项</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>默认</th>
<th>释义</th>
</tr>
</thead>
<tbody><tr>
<td>msgs</td>
<td>10</td>
<td>条数</td>
</tr>
<tr>
<td>time</td>
<td>15000</td>
<td>持续时间</td>
</tr>
<tr>
<td>procs</td>
<td>all</td>
<td>all 或 指定的pid列表</td>
</tr>
<tr>
<td>records</td>
<td>[]</td>
<td>模块名列表，从其取出record</td>
</tr>
<tr>
<td>print_file</td>
<td>“”</td>
<td>打印输出文件，默认为standard_io(屏幕)</td>
</tr>
<tr>
<td>print_mesc</td>
<td>false</td>
<td>显示时间精确到毫秒否</td>
</tr>
<tr>
<td>print_return</td>
<td>true</td>
<td>显示返回值否</td>
</tr>
<tr>
<td>print_fun</td>
<td>‘’</td>
<td>自定义显示函数</td>
</tr>
<tr>
<td>arity</td>
<td>false</td>
<td>true:显示参数个数 false:显示参数详细</td>
</tr>
</tbody></table>
<h4 id="recon"><a href="#recon" class="headerlink" title="recon"></a>recon</h4><h5 id="recon-trace"><a href="#recon-trace" class="headerlink" title="recon_trace"></a>recon_trace</h5><p>以安全的方式监听单个erlang节点的函数调用，会创建一个进程去收集信息并处理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">recon_trace:calls(TSpecs::tspec() | [tspec(), ...], Max::max(), Opts::options()) -&gt; num_matches()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">recon_trace:call(&#123;dev, online, &#x27;_&#x27;&#125;, 100, []).</span><br><span class="line">% 带返回结果</span><br><span class="line">recon_trace:call(&#123;dev, online,  return_trace&#125;, 100, []).</span><br><span class="line">% 自定义输出打印 A = &#123;trace, Pid, call, &#123;M, F, A&#125;&#125;</span><br><span class="line">recon_trace:call(&#123;dev, online, &#x27;_&#x27;&#125;, 100, [&#123;formatter, fun(A)-&gt; io_lib:format(&quot;&quot;, [A]) end&#125;]).</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>参数</th>
<th>默认</th>
<th>释义</th>
</tr>
</thead>
<tbody><tr>
<td>scope</td>
<td>global</td>
<td>local:跟踪包括本地调用 global:只限mfa的调用</td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="http://ferd.github.io/recon/recon_trace.html#type-args">文档</a></p>
<h4 id="12-Tool"><a href="#12-Tool" class="headerlink" title="12. Tool"></a>12. Tool</h4><h5 id="tags"><a href="#tags" class="headerlink" title="tags"></a>tags</h5><p>标签，用于生成EMACS的跳转函数，几乎不用，ctags就能支持了，且有更多适合erlang编辑的工具，如eclipse，Idea</p>
<h5 id="cprof"><a href="#cprof" class="headerlink" title="cprof"></a>cprof</h5><p>一个基于断点的调用次数分析工具，使用时性能相对会下降10%</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">% 使用流程</span><br><span class="line">cprof:start().          % 开始统计</span><br><span class="line">cprof:pause().         % 暂停统计 </span><br><span class="line">cprof:analyse().       % 分析并打印结果</span><br><span class="line">cprof:restart().        % 重新开启统计</span><br><span class="line">cprof:stop().           % 结束统计</span><br><span class="line">```     </span><br><span class="line">以上函数都支持0-3参数（analyse除外）</span><br><span class="line"> - 0参数 表示监听所有已加载的模块，除了eprof自身</span><br><span class="line"> - Mod 监听某个模块</span><br><span class="line"> - Mod, Fun 监听某个函数，无论是否有导出</span><br><span class="line"> - Mod, Fun, Arty</span><br><span class="line"></span><br><span class="line">分析输出数据：</span><br><span class="line">&#123;调用总次数, [&#123;Mod, 模块凑数, [&#123;&#123;Mod, Fun&#125;, 函数次数&#125;]&#125;]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##### eprof</span><br><span class="line">时间分析工具，基于trace监控指定进程（及其创建的进程）的函数时间消耗，会影响系统性能</span><br></pre></td></tr></table></figure>
<p>% 使用流程<br>eprof:start().                                      % 启动分析进程<br>eprof:start_profiling(PidL).                     % 开始分析<br>eprof:stop_profiling().                         % 结束分析<br>eprof:log(FileName).                           % 分析结果输出到指定文件<br>eprof:analyze(procs | total [, Opt]).      % 分析输出结果<br>eprof:stop().                                    % 停止进程</p>
<pre><code>
- analyze
    - procs 分析结果按进程分类
    - total 分析结果汇总
    - Opt = [&#123;filter, Filter&#125; | &#123;sort, Sort&#125;]
        - Sort = time | calls | mfa 指定排序的列
        
分析输出数据：
Mod:Fun/Arty  | 调用次数 | 占用百分比 | 总消耗时间 | 每次消耗时间
    



[erlang应用文档](https://www.erlang.org/doc/applications.html)
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="欣然"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">欣然</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">欣然</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
